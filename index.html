<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Private HackChat Client</title>
<style>
body {
    background: #111;
    color: #0f0;
    font-family: monospace;
    margin: 0;
    padding: 20px;
}
#chat { display:none; }
#messages {
    height: 80vh;
    overflow-y: auto;
    border: 1px solid #0f0;
    padding: 10px;
}
input, button {
    padding: 10px;
    background: #222;
    border: 1px solid #0f0;
    color: #0f0;
    font-family: monospace;
}
button { cursor: pointer; }
</style>
</head>
<body>

<div id="login">
    <h2>Room name:</h2>
    <input id="room"><br><br>

    <h2>Nickname:</h2>
    <input id="nick"><br><br>

    <button onclick="join()">Join</button>
</div>

<div id="chat">
    <div id="messages"></div><br>
    <input id="msgInput" placeholder="type..." onkeydown="if(event.key==='Enter') sendMsg()">
    <button onclick="sendMsg()">Send</button>
</div>

<script>
let ws;
let room, nick;

function join() {
    room = document.getElementById("room").value.trim();
    nick = document.getElementById("nick").value.trim();

    if (!room || !nick) { alert("Enter both"); return; }

    document.getElementById("login").style.display = "none";
    document.getElementById("chat").style.display = "block";

    ws = new WebSocket("wss://ws.hack.chat/chat-ws");

    ws.onopen = () => {
        ws.send(JSON.stringify({
            cmd: "join",
            channel: room,
            nick: nick
        }));
        printMsg("[system] connected as " + nick);
    };

    ws.onmessage = (event) => {
        let data = JSON.parse(event.data);

        if (data.cmd === "chat") {
            printMsg(data.nick + ": " + data.text);
        }

        if (data.cmd === "onlineSet") {
            printMsg("[system] online: " + data.nicks.join(", "));
        }

        if (data.cmd === "info") {
            printMsg("[info] " + data.text);
        }
    };
}

function sendMsg() {
    let t = document.getElementById("msgInput").value.trim();
    if (!t) return;

    // send to server
    ws.send(JSON.stringify({
        cmd: "chat",
        channel: room,
        text: t
    }));

    // show OWN message locally (hack.chat does not echo)
    printMsg(nick + ": " + t);

    document.getElementById("msgInput").value = "";
}

function printMsg(t) {
    const d = document.createElement("div");
    d.textContent = t;
    document.getElementById("messages").appendChild(d);
    d.scrollIntoView();
}
</script>

</body>
</html>
